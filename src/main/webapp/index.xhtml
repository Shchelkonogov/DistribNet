<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">
<h:head>
    <title>Мнемосхема разводящей сети</title>
    <h:outputStylesheet name="style.css" library="css"/>
</h:head>
<h:body>
    <h:form id="css-style">
        <style type="text/css">#{graph.styles}</style>
    </h:form>

    <table class="table-style" cellspacing="0" cellpadding="0">
        <tr>
            <td valign="top" style="width: 48.1em; min-width: 48.1em">
                <h:form id="left" style="height: calc(100% - 45px);">
                    <p:diagram id="diaLeft"
                               value="#{graph.diagramModelLeft}"
                               style="min-height: 400px; height: 100%; overflow: hidden;"
                               var="el">
                        <f:facet name="element">
                            <h:outputText value="#{el.name}" style="display: block; margin-top: -1em;"/>
                            <p:repeat value="#{el.values}" var="value" varStatus="status">
                                <h:outputText styleClass="#{el.className}#{el.size} textLeftGraph#{status.index}"
                                              value="#{value}"
                                              style="position: absolute;"/>
                            </p:repeat>
                        </f:facet>
                    </p:diagram>

                    <p:repeat value="#{graph.producerIndex}" var="el" varStatus="status">
                        <div class="ui-widget #{el.color} init#{status.index}">
                            #{el.value}
                        </div>
                    </p:repeat>

                    <div style="position: absolute; 
                                top: 48px; 
                                left: 358px; 
                                transform: translate(-50%, 0px);
                                font-weight: bold;
                                color: #464F60;
                                background: #{graph.temperatureColor}"
                         class="ui-widget">
                        #{graph.temperature}
                    </div>
                </h:form>

                <h:form>
                    <table style="width: 100%">
                        <tr>
                            <td>
                                <p:selectBooleanButton styleClass="boolean-button-bar"
                                                       value="#{graph.co}"
                                                       rendered="#{graph.visibleCo}"
                                                       onLabel="ЦО" offLabel="ЦО"
                                                       onIcon="pi pi-check" offIcon="pi pi-times">
                                    <p:ajax update="left right css-style tooltip-form error-form" listener="#{graph.changeButton}"/>
                                </p:selectBooleanButton>
                                <p:selectBooleanButton styleClass="boolean-button-bar"
                                                       value="#{graph.gvs}"
                                                       rendered="#{graph.visibleGvs}"
                                                       onLabel="ГВС" offLabel="ГВС"
                                                       onIcon="pi pi-check" offIcon="pi pi-times">
                                    <p:ajax update="left right css-style tooltip-form error-form" listener="#{graph.changeButton}"/>
                                </p:selectBooleanButton>
                                <p:selectBooleanButton styleClass="boolean-button-bar"
                                                       value="#{graph.vent}"
                                                       rendered="#{graph.visibleVent}"
                                                       onLabel="Вент" offLabel="Вент"
                                                       onIcon="pi pi-check" offIcon="pi pi-times">
                                    <p:ajax update="left right css-style tooltip-form error-form" listener="#{graph.changeButton}"/>
                                </p:selectBooleanButton>
                            </td>
                            <td style="width: 35px; text-align: right;">
                                <p:button outcome="index.xhtml?object=#{graph.object}&amp;date=#{graph.beforeDate}"
                                          icon="pi pi-angle-left"/>
                            </td>
                            <td style="width: 80px; text-align: center;">
                                <div style="font-weight: bold; color: #464F60;">#{graph.date}</div>
                            </td>
                            <td style="width: 35px; text-align: left;">
                                <p:button outcome="index.xhtml?object=#{graph.object}&amp;date=#{graph.nextDate}"
                                          icon="pi pi-angle-right"/>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </td>
            <td valign="top" style="min-width: 35em">
                <h:form id="right" style="height: 100%">
                    <p:diagram id="diaRight"
                               value="#{graph.diagramModelRight}"
                               style="min-height: 500px; height: 100%"
                               var="el">
                        <f:facet name="element">
                            <h:outputText value="#{el.name}" style="display: block; margin-top: -1em;"/>
                            <p:repeat value="#{el.values}" var="value" varStatus="status">
                                <h:outputText styleClass="#{el.className}#{el.size} textRightGraph#{status.index}"
                                              value="#{value}"
                                              style="position: absolute;"/>
                            </p:repeat>
                        </f:facet>
                    </p:diagram>
                </h:form>
            </td>
        </tr>
    </table>

    <h:form id="tooltip-form">
        <p:repeat value="#{graph.tooltips}" var="tooltip">
            <pe:tooltip for="@(##{tooltip.id})" value="#{tooltip.value}"
                        mouseTracking="true" myPosition="top left" adjustX="10" adjustY="10"
                        styleClass="qtip qtip-dark qtip-rounded qtip-shadow"/>
        </p:repeat>
    </h:form>

    <h:form id="error-form">
        <div style="position: absolute; top: 20px; left: 50%">
            #{graph.error}
        </div>
    </h:form>
</h:body>
</html>
